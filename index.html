<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IONM Bibliometric Analysis</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
:root{--bg:#f6f5f1;--card:#fff;--ink:#1a1a1a;--ink2:#555;--ink3:#888;--accent:#2d5a7b;--border:#e0ddd6;--hic:#2d5a7b;--umic:#d4a03c;--lmic:#c0392b;--shadow:0 1px 3px rgba(0,0,0,.06)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--ink);line-height:1.6;-webkit-font-smoothing:antialiased}
.container{max-width:1340px;margin:0 auto;padding:0 24px}
header{background:#1a2332;color:#fff;padding:48px 0 40px;border-bottom:4px solid var(--accent)}
header h1{font-family:'DM Serif Display',serif;font-size:2rem;font-weight:400;letter-spacing:-.02em;margin-bottom:8px}
header p{color:#a0aec0;font-size:.95rem;max-width:760px}
.summary-strip{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:16px;margin:-28px 0 32px;position:relative;z-index:1}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:20px 20px 16px;box-shadow:var(--shadow)}
.stat-card .label{font-size:.73rem;text-transform:uppercase;letter-spacing:.08em;color:var(--ink3);margin-bottom:4px}
.stat-card .value{font-family:'DM Serif Display',serif;font-size:1.7rem;color:var(--accent)}
.stat-card .sub{font-size:.79rem;color:var(--ink2);margin-top:2px}
section{margin-bottom:40px}
.section-title{font-family:'DM Serif Display',serif;font-size:1.35rem;font-weight:400;margin-bottom:6px;color:var(--ink);border-bottom:2px solid var(--accent);padding-bottom:8px;display:inline-block}
.section-desc{font-size:.88rem;color:var(--ink2);margin-bottom:20px;max-width:800px}
.chart-grid{display:grid;gap:20px;margin-bottom:24px}
.chart-grid.two{grid-template-columns:1fr 1fr}
@media(max-width:900px){.chart-grid.two{grid-template-columns:1fr}}
.chart-box{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:20px;box-shadow:var(--shadow)}
.chart-box h3{font-size:.83rem;font-weight:600;color:var(--ink2);margin-bottom:12px;text-transform:uppercase;letter-spacing:.04em}
.chart-box canvas{width:100%!important}
.table-wrap{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow-x:auto;box-shadow:var(--shadow)}
table{width:100%;border-collapse:collapse;font-size:.8rem}
thead{background:#1a2332;color:#fff}
th{padding:10px 12px;text-align:left;font-weight:600;font-size:.73rem;text-transform:uppercase;letter-spacing:.04em;white-space:nowrap;cursor:pointer;user-select:none}
th:hover{background:#2a3a4f}
td{padding:8px 12px;border-bottom:1px solid var(--border);white-space:nowrap}
tbody tr:hover{background:#f0efe9}
.badge{display:inline-block;padding:2px 8px;border-radius:3px;font-size:.7rem;font-weight:600;letter-spacing:.02em}
.b-hic{background:#dbeafe;color:#1e40af}
.b-umic{background:#fef3c7;color:#92400e}
.b-lmic{background:#fce7e7;color:#991b1b}
.b-lic{background:#f3e8ff;color:#6b21a8}
td.n{text-align:right;font-variant-numeric:tabular-nums}
.bar-cell{display:flex;align-items:center;gap:6px}
.bar-fill{height:6px;border-radius:3px;background:var(--accent)}
footer{border-top:1px solid var(--border);padding:24px 0;margin-top:20px;color:var(--ink3);font-size:.76rem}
.findings{background:#1a2332;color:#e2e8f0;border-radius:8px;padding:24px 28px;margin-bottom:32px;font-size:.88rem;line-height:1.7}
.findings h3{color:#fff;font-family:'DM Serif Display',serif;font-size:1.1rem;margin-bottom:10px;font-weight:400}
.findings strong{color:#90cdf4}
.tab-bar{display:flex;gap:4px;margin-bottom:16px;flex-wrap:wrap}
.tab-btn{padding:6px 16px;border:1px solid var(--border);background:var(--card);border-radius:4px;font-size:.8rem;cursor:pointer;font-family:inherit;color:var(--ink2);transition:all .15s}
.tab-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.tab-btn:hover:not(.active){background:#eee}
.legend-row{display:flex;gap:16px;margin-bottom:14px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:5px;font-size:.78rem;color:var(--ink2)}
.legend-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
</style>
</head>
<body>
<header><div class="container">
  <h1>Intraoperative Neurophysiological Monitoring: Bibliometric Analysis</h1>
  <p>Country-level demographics, income classifications, and healthcare and research spending metrics across 1,203 publications from 55 contributing nations.</p>
</div></header>

<div class="container">
<div class="summary-strip" id="summaryStrip"></div>
<div class="findings" id="findings"></div>

<section>
  <h2 class="section-title">Publication Distribution by Income &amp; Region</h2>
  <p class="section-desc">Distribution of first-author publications across World Bank income classifications and continental regions. 64 publications with unidentifiable affiliations excluded.</p>
  <div class="chart-grid two">
    <div class="chart-box"><h3>World Bank Income Classification</h3><canvas id="incomeChart"></canvas></div>
    <div class="chart-box"><h3>Continental Distribution</h3><canvas id="continentChart"></canvas></div>
  </div>
</section>

<section>
  <h2 class="section-title">Healthcare Spending Metrics</h2>
  <p class="section-desc">Healthcare expenditure indicators across contributing countries, coloured by income classification. Bubble size proportional to publication count.</p>
  <div class="legend-row">
    <div class="legend-item"><div class="legend-dot" style="background:#2d5a7b"></div>High Income (HIC)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#d4a03c"></div>Upper Middle Income (UMIC)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#c0392b"></div>Lower Middle Income (LMIC)</div>
  </div>
  <div class="chart-grid two">
    <div class="chart-box"><h3>Healthcare Spending as % of GDP (Top 25)</h3><div style="height:680px"><canvas id="hcPctGdpChart"></canvas></div></div>
    <div class="chart-box"><h3>Healthcare Spending per Capita, USD (Top 25)</h3><div style="height:680px"><canvas id="hcPerCapChart"></canvas></div></div>
  </div>
  <div class="chart-grid two">
    <div class="chart-box"><h3>GDP per Capita vs Healthcare Spending per Capita</h3><div style="height:380px"><canvas id="gdpVsHcScatter"></canvas></div></div>
    <div class="chart-box"><h3>HDI vs Healthcare Spending per Capita</h3><div style="height:380px"><canvas id="hdiVsHcScatter"></canvas></div></div>
  </div>
</section>

<section>
  <h2 class="section-title">Research &amp; Development Spending</h2>
  <p class="section-desc">National R&amp;D expenditure as a percentage of GDP. Scatter shows relationship to IONM publication count.</p>
  <div class="chart-grid two">
    <div class="chart-box"><h3>R&amp;D Spending as % of GDP (Top 25)</h3><div style="height:680px"><canvas id="resPctGdpChart"></canvas></div></div>
    <div class="chart-box"><h3>R&amp;D (% GDP) vs Publication Count</h3><div style="height:380px"><canvas id="resVsPapersScatter"></canvas></div></div>
  </div>
</section>

<section>
  <h2 class="section-title">Economic Development vs Output</h2>
  <p class="section-desc">Relationships between national economic indicators, human development, and research output.</p>
  <div class="chart-grid two">
    <div class="chart-box"><h3>GDP per Capita vs Publication Count</h3><div style="height:380px"><canvas id="gdpVsPapersChart"></canvas></div></div>
    <div class="chart-box"><h3>HDI vs Publication Count</h3><div style="height:380px"><canvas id="hdiVsPapersChart"></canvas></div></div>
  </div>
</section>

<section>
  <h2 class="section-title">Country-Level Demographic and Spending Data</h2>
  <p class="section-desc">Complete dataset for all contributing countries. Click column headers to sort.</p>
  <div class="tab-bar" id="tableTabs">
    <button class="tab-btn active" data-tab="all">All Countries</button>
    <button class="tab-btn" data-tab="HIC">HIC</button>
    <button class="tab-btn" data-tab="UMIC">Upper Middle</button>
    <button class="tab-btn" data-tab="LMIC">Lower Middle</button>
  </div>
  <div class="table-wrap"><table id="countryTable">
    <thead><tr>
      <th data-sort="name">Country</th><th data-sort="papers">Papers</th><th data-sort="pct">%</th>
      <th data-sort="continent">Continent</th><th data-sort="income">Income</th>
      <th data-sort="gdp_pc">GDP/Cap</th><th data-sort="ppp">PPP</th><th data-sort="hdi">HDI</th>
      <th data-sort="hc_pct">HC % GDP</th><th data-sort="hc_cap">HC/Cap</th><th data-sort="rd">R&amp;D % GDP</th>
    </tr></thead>
    <tbody id="countryTableBody"></tbody>
  </table></div>
</section>

<section>
  <h2 class="section-title">Most Prolific Authors (Combined First + Last)</h2>
  <p class="section-desc">Top 25 authors ranked by total appearances as first or last author. *Abbreviated name variant counted separately in source.</p>
  <div class="chart-box"><div style="height:740px"><canvas id="authorChart"></canvas></div></div>
</section>

<section>
  <h2 class="section-title">Aggregated Metrics by Income Classification</h2>
  <p class="section-desc">Mean values of economic and healthcare indicators grouped by World Bank income classification.</p>
  <div class="table-wrap"><table>
    <thead><tr><th>Income Group</th><th>Countries (n)</th><th>Total Papers</th><th>% of Total</th>
    <th>Mean GDP/Cap</th><th>Mean HDI</th><th>Mean HC % GDP</th><th>Mean HC/Cap</th><th>Mean R&amp;D % GDP</th></tr></thead>
    <tbody id="incomeTableBody"></tbody>
  </table></div>
</section>
</div>

<footer><div class="container">
  Data sources: PubMed (publication counts by first-author affiliation), World Bank Open Data (GDP, healthcare expenditure, R&amp;D), UNDP Human Development Reports (HDI). HC = Healthcare. R&amp;D = Research &amp; Development. PPP = Purchasing Power Parity. HDI = Human Development Index.
</div></footer>

<script>
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.color = '#666';

const C = [
  {name:"USA",papers:231,pct:19.2,continent:"N. America",income:"HIC",gdp_pc:85370,ppp:81000,hdi:.927,hc_pct:16.6,hc_cap:12474,rd:3.46},
  {name:"France",papers:146,pct:12.1,continent:"Europe",income:"HIC",gdp_pc:47360,ppp:56000,hdi:.910,hc_pct:12.3,hc_cap:5381,rd:2.28},
  {name:"Japan",papers:126,pct:10.5,continent:"Asia",income:"HIC",gdp_pc:33140,ppp:49000,hdi:.920,hc_pct:10.8,hc_cap:4347,rd:3.30},
  {name:"Italy",papers:97,pct:8.1,continent:"Europe",income:"HIC",gdp_pc:39580,ppp:51000,hdi:.920,hc_pct:9.0,hc_cap:3066,rd:1.45},
  {name:"Germany",papers:62,pct:5.2,continent:"Europe",income:"HIC",gdp_pc:54290,ppp:63000,hdi:.950,hc_pct:12.7,hc_cap:6191,rd:3.14},
  {name:"UK",papers:58,pct:4.8,continent:"Europe",income:"HIC",gdp_pc:51070,ppp:57000,hdi:.940,hc_pct:11.3,hc_cap:5139,rd:2.90},
  {name:"Canada",papers:50,pct:4.2,continent:"N. America",income:"HIC",gdp_pc:54966,ppp:60000,hdi:.935,hc_pct:12.2,hc_cap:5905,rd:1.69},
  {name:"China",papers:42,pct:3.5,continent:"Asia",income:"UMIC",gdp_pc:13140,ppp:23000,hdi:.789,hc_pct:5.4,hc_cap:671,rd:2.43},
  {name:"Netherlands",papers:38,pct:3.2,continent:"Europe",income:"HIC",gdp_pc:63750,ppp:69000,hdi:.946,hc_pct:11.3,hc_cap:6539,rd:2.31},
  {name:"Spain",papers:28,pct:2.3,continent:"Europe",income:"HIC",gdp_pc:34050,ppp:52000,hdi:.911,hc_pct:10.7,hc_cap:3234,rd:1.44},
  {name:"India",papers:24,pct:2.0,continent:"Asia",income:"LMIC",gdp_pc:2730,ppp:10000,hdi:.644,hc_pct:3.3,hc_cap:74,rd:0.65},
  {name:"Israel",papers:21,pct:1.8,continent:"Asia",income:"HIC",gdp_pc:53370,ppp:55000,hdi:.915,hc_pct:7.9,hc_cap:4339,rd:5.56},
  {name:"Brazil",papers:20,pct:1.7,continent:"S. America",income:"UMIC",gdp_pc:11350,ppp:17000,hdi:.760,hc_pct:9.9,hc_cap:761,rd:1.15},
  {name:"Pakistan",papers:16,pct:1.3,continent:"Asia",income:"LMIC",gdp_pc:1505,ppp:6500,hdi:.544,hc_pct:3.2,hc_cap:46,rd:0.25},
  {name:"Russia",papers:13,pct:1.1,continent:"Europe/Asia",income:"UMIC",gdp_pc:14390,ppp:33000,hdi:.821,hc_pct:7.4,hc_cap:936,rd:0.94},
  {name:"Taiwan",papers:12,pct:1.0,continent:"Asia",income:"HIC",gdp_pc:34430,ppp:66000,hdi:.907,hc_pct:6.6,hc_cap:3074,rd:3.76},
  {name:"Switzerland",papers:11,pct:0.9,continent:"Europe",income:"HIC",gdp_pc:105670,ppp:78000,hdi:.967,hc_pct:11.8,hc_cap:9674,rd:3.37},
  {name:"South Korea",papers:10,pct:0.8,continent:"Asia",income:"HIC",gdp_pc:34160,ppp:56000,hdi:.929,hc_pct:9.7,hc_cap:3124,rd:4.93},
  {name:"Turkey",papers:10,pct:0.8,continent:"Europe/Asia",income:"UMIC",gdp_pc:12760,ppp:41000,hdi:.855,hc_pct:4.6,hc_cap:441,rd:1.40},
  {name:"Sweden",papers:8,pct:0.7,continent:"Europe",income:"HIC",gdp_pc:60240,ppp:63000,hdi:.952,hc_pct:11.3,hc_cap:6600,rd:3.40},
  {name:"Poland",papers:8,pct:0.7,continent:"Europe",income:"HIC",gdp_pc:23010,ppp:42000,hdi:.881,hc_pct:6.7,hc_cap:1225,rd:1.44},
  {name:"Singapore",papers:8,pct:0.7,continent:"Asia",income:"HIC",gdp_pc:88450,ppp:97000,hdi:.949,hc_pct:5.6,hc_cap:3970,rd:2.16},
  {name:"Australia",papers:8,pct:0.7,continent:"Oceania",income:"HIC",gdp_pc:65100,ppp:60000,hdi:.951,hc_pct:10.6,hc_cap:6527,rd:1.68},
  {name:"Iran",papers:7,pct:0.6,continent:"Asia",income:"UMIC",gdp_pc:5310,ppp:18000,hdi:.780,hc_pct:5.8,hc_cap:393,rd:0.93},
  {name:"Belgium",papers:7,pct:0.6,continent:"Europe",income:"HIC",gdp_pc:56380,ppp:63000,hdi:.942,hc_pct:11.1,hc_cap:5971,rd:3.44},
  {name:"Mexico",papers:6,pct:0.5,continent:"N. America",income:"UMIC",gdp_pc:15250,ppp:25000,hdi:.781,hc_pct:6.1,hc_cap:611,rd:0.27},
  {name:"Greece",papers:5,pct:0.4,continent:"Europe",income:"HIC",gdp_pc:24270,ppp:38000,hdi:.893,hc_pct:9.2,hc_cap:2060,rd:1.50},
  {name:"Morocco",papers:5,pct:0.4,continent:"Africa",income:"LMIC",gdp_pc:3930,ppp:9600,hdi:.698,hc_pct:6.0,hc_cap:214,rd:0.75},
  {name:"Egypt",papers:5,pct:0.4,continent:"Africa",income:"LMIC",gdp_pc:4295,ppp:16900,hdi:.731,hc_pct:4.4,hc_cap:155,rd:0.96},
  {name:"Argentina",papers:5,pct:0.4,continent:"S. America",income:"UMIC",gdp_pc:13650,ppp:26000,hdi:.849,hc_pct:10.0,hc_cap:1305,rd:0.46},
  {name:"Nigeria",papers:5,pct:0.4,continent:"Africa",income:"LMIC",gdp_pc:1620,ppp:5900,hdi:.539,hc_pct:3.3,hc_cap:29,rd:0.13},
  {name:"Finland",papers:5,pct:0.4,continent:"Europe",income:"HIC",gdp_pc:54590,ppp:57000,hdi:.942,hc_pct:10.0,hc_cap:5274,rd:2.92},
  {name:"Philippines",papers:4,pct:0.3,continent:"Asia",income:"LMIC",gdp_pc:3950,ppp:12000,hdi:.710,hc_pct:4.4,hc_cap:171,rd:0.16},
  {name:"Peru",papers:4,pct:0.3,continent:"S. America",income:"UMIC",gdp_pc:7770,ppp:16000,hdi:.762,hc_pct:6.3,hc_cap:412,rd:0.13},
  {name:"Portugal",papers:4,pct:0.3,continent:"Europe",income:"HIC",gdp_pc:27970,ppp:42000,hdi:.874,hc_pct:10.6,hc_cap:2850,rd:1.69},
  {name:"Austria",papers:4,pct:0.3,continent:"Europe",income:"HIC",gdp_pc:59230,ppp:66000,hdi:.930,hc_pct:11.5,hc_cap:6693,rd:3.20},
  {name:"Malaysia",papers:3,pct:0.3,continent:"Asia",income:"UMIC",gdp_pc:12570,ppp:34000,hdi:.807,hc_pct:4.1,hc_cap:490,rd:1.01},
  {name:"Colombia",papers:2,pct:0.2,continent:"S. America",income:"UMIC",gdp_pc:7020,ppp:18000,hdi:.758,hc_pct:8.9,hc_cap:540,rd:0.29},
  {name:"Lebanon",papers:2,pct:0.2,continent:"Asia",income:"UMIC",gdp_pc:4070,ppp:14000,hdi:.723,hc_pct:7.6,hc_cap:512,rd:null},
  {name:"Oman",papers:2,pct:0.2,continent:"Asia",income:"HIC",gdp_pc:25370,ppp:42000,hdi:.821,hc_pct:5.0,hc_cap:980,rd:0.24},
  {name:"Thailand",papers:2,pct:0.2,continent:"Asia",income:"UMIC",gdp_pc:7660,ppp:22000,hdi:.802,hc_pct:4.4,hc_cap:309,rd:1.34},
  {name:"Saudi Arabia",papers:2,pct:0.2,continent:"Asia",income:"HIC",gdp_pc:30440,ppp:59000,hdi:.875,hc_pct:6.4,hc_cap:1824,rd:0.80},
  {name:"Denmark",papers:2,pct:0.2,continent:"Europe",income:"HIC",gdp_pc:68300,ppp:66000,hdi:.952,hc_pct:10.6,hc_cap:7143,rd:2.85},
  {name:"Ecuador",papers:1,pct:0.1,continent:"S. America",income:"UMIC",gdp_pc:6310,ppp:12000,hdi:.765,hc_pct:8.5,hc_cap:522,rd:0.34},
  {name:"UAE",papers:1,pct:0.1,continent:"Asia",income:"HIC",gdp_pc:50600,ppp:79000,hdi:.937,hc_pct:5.0,hc_cap:2146,rd:1.47},
  {name:"Qatar",papers:1,pct:0.1,continent:"Asia",income:"HIC",gdp_pc:82870,ppp:101000,hdi:.875,hc_pct:3.9,hc_cap:2664,rd:0.44},
  {name:"Albania",papers:1,pct:0.1,continent:"Europe",income:"UMIC",gdp_pc:7400,ppp:17000,hdi:.796,hc_pct:5.3,hc_cap:283,rd:0.14},
  {name:"Bulgaria",papers:1,pct:0.1,continent:"Europe",income:"UMIC",gdp_pc:14760,ppp:30000,hdi:.799,hc_pct:8.6,hc_cap:1071,rd:0.77},
  {name:"Bahrain",papers:1,pct:0.1,continent:"Asia",income:"HIC",gdp_pc:30120,ppp:59000,hdi:.888,hc_pct:3.9,hc_cap:1232,rd:0.10},
  {name:"Indonesia",papers:1,pct:0.1,continent:"Asia",income:"UMIC",gdp_pc:4920,ppp:15000,hdi:.713,hc_pct:2.9,hc_cap:136,rd:0.24},
  {name:"Slovenia",papers:1,pct:0.1,continent:"Europe",income:"HIC",gdp_pc:32750,ppp:48000,hdi:.926,hc_pct:9.4,hc_cap:2860,rd:2.13},
  {name:"South Africa",papers:1,pct:0.1,continent:"Africa",income:"UMIC",gdp_pc:6190,ppp:16000,hdi:.717,hc_pct:8.5,hc_cap:545,rd:0.62},
  {name:"New Zealand",papers:1,pct:0.1,continent:"Oceania",income:"HIC",gdp_pc:48070,ppp:49000,hdi:.939,hc_pct:10.0,hc_cap:4628,rd:1.37},
  {name:"Norway",papers:1,pct:0.1,continent:"Europe",income:"HIC",gdp_pc:87930,ppp:72000,hdi:.966,hc_pct:11.4,hc_cap:9715,rd:2.28},
  {name:"Ukraine",papers:1,pct:0.1,continent:"Europe",income:"LMIC",gdp_pc:5660,ppp:13000,hdi:.734,hc_pct:8.0,hc_cap:368,rd:0.33},
];

const incomeLabels={HIC:'High Income',UMIC:'Upper Middle Income',LMIC:'Lower Middle Income'};
const incomeColours={HIC:'#2d5a7b',UMIC:'#d4a03c',LMIC:'#c0392b'};
const cCol=c=>incomeColours[c.income]||'#888';

const topAuthors=[
  {name:"Duffau, Hugues",total:99,first:28,last:71,country:"France"},
  {name:"Berger, Mitchel S",total:20,first:1,last:19,country:"USA"},
  {name:"Duffau, H*",total:18,first:9,last:9,country:"France"},
  {name:"Bernstein, Mark",total:17,first:0,last:17,country:"Canada"},
  {name:"Mandonnet, Emmanuel",total:13,first:5,last:8,country:"France"},
  {name:"Bello, Lorenzo",total:13,first:2,last:11,country:"Italy"},
  {name:"Kawamata, T",total:10,first:0,last:10,country:"Japan"},
  {name:"Ng, Sam",total:9,first:9,last:0,country:"France"},
  {name:"Saito, Taiichi",total:9,first:9,last:0,country:"Japan"},
  {name:"Shinoura, N",total:9,first:7,last:2,country:"Japan"},
  {name:"Herbet, Guillaume",total:9,first:1,last:8,country:"France"},
  {name:"Krieg, Sandro M",total:9,first:2,last:7,country:"Germany"},
  {name:"Quinones-Hinojosa, A",total:9,first:0,last:9,country:"USA"},
  {name:"Tomasino, Barbara",total:8,first:5,last:3,country:"Italy"},
  {name:"Hervey-Jumper, S",total:8,first:2,last:6,country:"USA"},
  {name:"Menei, Philippe",total:8,first:0,last:8,country:"France"},
  {name:"Ram, Zvi",total:8,first:0,last:8,country:"Israel"},
  {name:"Arakawa, Yoshiki",total:7,first:1,last:6,country:"Japan"},
  {name:"Spena, G",total:7,first:6,last:1,country:"Italy"},
  {name:"Skrap, Miran",total:7,first:1,last:6,country:"Italy"},
  {name:"Grossman, Rachel",total:7,first:2,last:5,country:"Israel"},
  {name:"Komotar, Ricardo J",total:7,first:0,last:7,country:"USA"},
  {name:"Pallud, Johan",total:7,first:0,last:7,country:"France"},
  {name:"Wakabayashi, T",total:7,first:0,last:7,country:"Japan"},
  {name:"Motomura, Kazuya",total:6,first:6,last:0,country:"Japan"},
];

// ============================================================
// SUMMARY
// ============================================================
const hicP=C.filter(c=>c.income==='HIC').reduce((s,c)=>s+c.papers,0);
const known=C.reduce((s,c)=>s+c.papers,0);
const hicPct=((hicP/known)*100).toFixed(1);

document.getElementById('summaryStrip').innerHTML=`
  <div class="stat-card"><div class="label">Total Publications</div><div class="value">1,203</div><div class="sub">First-author affiliations</div></div>
  <div class="stat-card"><div class="label">Countries</div><div class="value">${C.length}</div><div class="sub">Identified nations</div></div>
  <div class="stat-card"><div class="label">Unique First Authors</div><div class="value">959</div><div class="sub">Across all studies</div></div>
  <div class="stat-card"><div class="label">HIC Share</div><div class="value">${hicPct}%</div><div class="sub">${hicP} of ${known} known</div></div>
  <div class="stat-card"><div class="label">Continents</div><div class="value">6</div><div class="sub">Africa: ${C.filter(c=>c.continent==='Africa').reduce((s,c)=>s+c.papers,0)} papers</div></div>`;

const mHcHIC=C.filter(c=>c.income==='HIC'&&c.hc_cap).reduce((s,c)=>s+c.hc_cap,0)/C.filter(c=>c.income==='HIC'&&c.hc_cap).length;
const nH=C.filter(c=>c.income!=='HIC'&&c.hc_cap);
const mHcNH=nH.reduce((s,c)=>s+c.hc_cap,0)/nH.length;
const rat=(mHcHIC/mHcNH).toFixed(0);

document.getElementById('findings').innerHTML=`<h3>Key Observations</h3><p>
IONM research output is overwhelmingly concentrated in high-income countries, which account for <strong>${hicPct}%</strong> of all publications with identifiable affiliations, despite representing ${C.filter(c=>c.income==='HIC').length} of ${C.length} contributing nations.
The USA, France, and Japan together produce 42% of the global literature.
Mean healthcare spending per capita among HICs ($${Math.round(mHcHIC).toLocaleString()}) is approximately <strong>${rat} times</strong> that of non-HICs ($${Math.round(mHcNH).toLocaleString()}).
Lower-middle-income countries contributed just ${C.filter(c=>c.income==='LMIC').reduce((s,c)=>s+c.papers,0)} papers across ${C.filter(c=>c.income==='LMIC').length} nations.
Africa is represented by only ${C.filter(c=>c.continent==='Africa').reduce((s,c)=>s+c.papers,0)} publications from ${C.filter(c=>c.continent==='Africa').length} countries.
Central Asia, the Caribbean, and the Pacific Islands are entirely absent from this literature.</p>`;

// ============================================================
// INCOME PIE
// ============================================================
{const g={};C.forEach(c=>{g[c.income]=(g[c.income]||0)+c.papers;});
new Chart(document.getElementById('incomeChart'),{type:'doughnut',data:{labels:Object.keys(g).map(k=>incomeLabels[k]),datasets:[{data:Object.values(g),backgroundColor:Object.keys(g).map(k=>incomeColours[k]),borderWidth:2,borderColor:'#fff'}]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{padding:14,font:{size:11}}},tooltip:{callbacks:{label:ctx=>` ${ctx.label}: ${ctx.parsed} papers (${((ctx.parsed/known)*100).toFixed(1)}%)`}}}}});}

// ============================================================
// CONTINENT BAR
// ============================================================
{const g={};C.forEach(c=>{g[c.continent]=(g[c.continent]||0)+c.papers;});
const s=Object.entries(g).sort((a,b)=>b[1]-a[1]);
const cc={'Europe':'#2d5a7b','N. America':'#1a7a5a','Asia':'#d4a03c','Europe/Asia':'#8e6bb5','S. America':'#c0392b','Africa':'#e67e22','Oceania':'#16a085'};
new Chart(document.getElementById('continentChart'),{type:'bar',data:{labels:s.map(x=>x[0]),datasets:[{data:s.map(x=>x[1]),backgroundColor:s.map(x=>cc[x[0]]||'#888')}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{display:false}},y:{title:{display:true,text:'Publications'},grid:{color:'#eee'}}}}});}

// ============================================================
// HC % GDP BAR
// ============================================================
{const s=[...C].filter(c=>c.hc_pct).sort((a,b)=>b.hc_pct-a.hc_pct).slice(0,25).reverse();
new Chart(document.getElementById('hcPctGdpChart'),{type:'bar',data:{labels:s.map(c=>c.name),datasets:[{data:s.map(c=>c.hc_pct),backgroundColor:s.map(c=>cCol(c))}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>` ${ctx.parsed.x.toFixed(1)}% of GDP`}}},scales:{x:{title:{display:true,text:'% of GDP'},grid:{display:false}},y:{grid:{display:false},ticks:{font:{size:10}}}}}});}

// ============================================================
// HC PER CAPITA BAR
// ============================================================
{const s=[...C].filter(c=>c.hc_cap).sort((a,b)=>b.hc_cap-a.hc_cap).slice(0,25).reverse();
new Chart(document.getElementById('hcPerCapChart'),{type:'bar',data:{labels:s.map(c=>c.name),datasets:[{data:s.map(c=>c.hc_cap),backgroundColor:s.map(c=>cCol(c))}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>` $${ctx.parsed.x.toLocaleString()} per capita`}}},scales:{x:{title:{display:true,text:'USD per capita'},grid:{display:false}},y:{grid:{display:false},ticks:{font:{size:10}}}}}});}

// ============================================================
// SCATTER: GDP/cap vs HC/cap
// ============================================================
{const ds=['HIC','UMIC','LMIC'].map(inc=>{const d=C.filter(c=>c.income===inc&&c.hc_cap&&c.gdp_pc);return{label:incomeLabels[inc],data:d.map(c=>({x:c.gdp_pc,y:c.hc_cap,r:Math.max(4,Math.sqrt(c.papers)*2.5),name:c.name})),backgroundColor:incomeColours[inc]+'99',borderColor:incomeColours[inc],borderWidth:1};});
new Chart(document.getElementById('gdpVsHcScatter'),{type:'bubble',data:{datasets:ds},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:12}},tooltip:{callbacks:{label:ctx=>`${ctx.raw.name}: GDP/cap $${ctx.raw.x.toLocaleString()}, HC/cap $${ctx.raw.y.toLocaleString()}`}}},scales:{x:{title:{display:true,text:'GDP per Capita (USD)'},type:'logarithmic',grid:{color:'#eee'}},y:{title:{display:true,text:'HC Spending per Capita (USD)'},type:'logarithmic',grid:{color:'#eee'}}}}});}

// ============================================================
// SCATTER: HDI vs HC/cap
// ============================================================
{const ds=['HIC','UMIC','LMIC'].map(inc=>{const d=C.filter(c=>c.income===inc&&c.hc_cap&&c.hdi);return{label:incomeLabels[inc],data:d.map(c=>({x:c.hdi,y:c.hc_cap,r:Math.max(4,Math.sqrt(c.papers)*2.5),name:c.name})),backgroundColor:incomeColours[inc]+'99',borderColor:incomeColours[inc],borderWidth:1};});
new Chart(document.getElementById('hdiVsHcScatter'),{type:'bubble',data:{datasets:ds},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:12}},tooltip:{callbacks:{label:ctx=>`${ctx.raw.name}: HDI ${ctx.raw.x.toFixed(3)}, HC/cap $${ctx.raw.y.toLocaleString()}`}}},scales:{x:{title:{display:true,text:'Human Development Index'},min:0.5,max:1.0,grid:{color:'#eee'}},y:{title:{display:true,text:'HC Spending per Capita (USD)'},type:'logarithmic',grid:{color:'#eee'}}}}});}

// ============================================================
// R&D % GDP BAR
// ============================================================
{const s=[...C].filter(c=>c.rd).sort((a,b)=>b.rd-a.rd).slice(0,25).reverse();
new Chart(document.getElementById('resPctGdpChart'),{type:'bar',data:{labels:s.map(c=>c.name),datasets:[{data:s.map(c=>c.rd),backgroundColor:s.map(c=>cCol(c))}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>` ${ctx.parsed.x.toFixed(2)}% of GDP`}}},scales:{x:{title:{display:true,text:'% of GDP'},grid:{display:false}},y:{grid:{display:false},ticks:{font:{size:10}}}}}});}

// ============================================================
// SCATTER: R&D vs Papers
// ============================================================
{const ds=['HIC','UMIC','LMIC'].map(inc=>{const d=C.filter(c=>c.income===inc&&c.rd);return{label:incomeLabels[inc],data:d.map(c=>({x:c.rd,y:c.papers,r:Math.max(5,Math.sqrt(c.hc_cap||1)*0.3),name:c.name})),backgroundColor:incomeColours[inc]+'99',borderColor:incomeColours[inc],borderWidth:1};});
new Chart(document.getElementById('resVsPapersScatter'),{type:'bubble',data:{datasets:ds},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:12}},tooltip:{callbacks:{label:ctx=>`${ctx.raw.name}: R&D ${ctx.raw.x.toFixed(2)}%, ${ctx.raw.y} papers`}}},scales:{x:{title:{display:true,text:'R&D Spending (% GDP)'},grid:{color:'#eee'}},y:{title:{display:true,text:'Publication Count'},grid:{color:'#eee'}}}}});}

// ============================================================
// GDP/cap vs Papers
// ============================================================
{const ds=['HIC','UMIC','LMIC'].map(inc=>{const d=C.filter(c=>c.income===inc&&c.gdp_pc);return{label:incomeLabels[inc],data:d.map(c=>({x:c.gdp_pc,y:c.papers,r:6,name:c.name})),backgroundColor:incomeColours[inc]+'99',borderColor:incomeColours[inc],borderWidth:1};});
new Chart(document.getElementById('gdpVsPapersChart'),{type:'bubble',data:{datasets:ds},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:12}},tooltip:{callbacks:{label:ctx=>`${ctx.raw.name}: $${ctx.raw.x.toLocaleString()}, ${ctx.raw.y} papers`}}},scales:{x:{title:{display:true,text:'GDP per Capita (USD)'},grid:{color:'#eee'}},y:{title:{display:true,text:'Publication Count'},grid:{color:'#eee'}}}}});}

// ============================================================
// HDI vs Papers
// ============================================================
{const ds=['HIC','UMIC','LMIC'].map(inc=>{const d=C.filter(c=>c.income===inc&&c.hdi);return{label:incomeLabels[inc],data:d.map(c=>({x:c.hdi,y:c.papers,r:6,name:c.name})),backgroundColor:incomeColours[inc]+'99',borderColor:incomeColours[inc],borderWidth:1};});
new Chart(document.getElementById('hdiVsPapersChart'),{type:'bubble',data:{datasets:ds},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:12}},tooltip:{callbacks:{label:ctx=>`${ctx.raw.name}: HDI ${ctx.raw.x.toFixed(3)}, ${ctx.raw.y} papers`}}},scales:{x:{title:{display:true,text:'Human Development Index'},min:0.5,max:1.0,grid:{color:'#eee'}},y:{title:{display:true,text:'Publication Count'},grid:{color:'#eee'}}}}});}

// ============================================================
// COUNTRY TABLE
// ============================================================
let cFilt='all',cSort={key:'papers',dir:'desc'};
function renderT(){
  let d=cFilt==='all'?[...C]:C.filter(c=>c.income===cFilt);
  d.sort((a,b)=>{let va=a[cSort.key],vb=b[cSort.key];if(typeof va==='string'){va=va.toLowerCase();vb=(vb||'').toLowerCase();}if(va==null)return 1;if(vb==null)return -1;return cSort.dir==='asc'?(va>vb?1:-1):(va<vb?1:-1);});
  const mx=Math.max(...C.map(c=>c.papers));
  document.getElementById('countryTableBody').innerHTML=d.map(c=>{
    const cls=c.income==='HIC'?'b-hic':c.income==='UMIC'?'b-umic':'b-lmic';
    return `<tr><td><strong>${c.name}</strong></td>
      <td class="n"><div class="bar-cell"><span class="bar-fill" style="width:${(c.papers/mx*80)}px"></span>${c.papers}</div></td>
      <td class="n">${c.pct}%</td><td>${c.continent}</td>
      <td><span class="badge ${cls}">${incomeLabels[c.income]}</span></td>
      <td class="n">$${c.gdp_pc?c.gdp_pc.toLocaleString():'—'}</td>
      <td class="n">$${c.ppp?c.ppp.toLocaleString():'—'}</td>
      <td class="n">${c.hdi?c.hdi.toFixed(3):'—'}</td>
      <td class="n">${c.hc_pct?c.hc_pct.toFixed(1)+'%':'—'}</td>
      <td class="n">${c.hc_cap?'$'+c.hc_cap.toLocaleString():'—'}</td>
      <td class="n">${c.rd?c.rd.toFixed(2)+'%':'—'}</td></tr>`;
  }).join('');
}
document.querySelectorAll('.tab-btn').forEach(b=>{b.addEventListener('click',function(){document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));this.classList.add('active');cFilt=this.dataset.tab;renderT();});});
document.querySelectorAll('#countryTable th[data-sort]').forEach(th=>{th.addEventListener('click',function(){const k=this.dataset.sort;if(cSort.key===k)cSort.dir=cSort.dir==='asc'?'desc':'asc';else cSort={key:k,dir:'desc'};renderT();});});
renderT();

// ============================================================
// AUTHORS (stacked bar)
// ============================================================
{const a=[...topAuthors].reverse();
new Chart(document.getElementById('authorChart'),{type:'bar',data:{labels:a.map(x=>`${x.name} (${x.country})`),datasets:[{label:'As First Author',data:a.map(x=>x.first),backgroundColor:'#2d5a7b'},{label:'As Last Author',data:a.map(x=>x.last),backgroundColor:'#6b9fc3'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{padding:14}},tooltip:{mode:'index'}},scales:{x:{stacked:true,title:{display:true,text:'Total Papers'},grid:{display:false}},y:{stacked:true,grid:{display:false},ticks:{font:{size:10}}}}}});}

// ============================================================
// INCOME AGGREGATION TABLE
// ============================================================
{const g={};C.forEach(c=>{const k=c.income;if(!g[k])g[k]={cs:[],p:0};g[k].cs.push(c);g[k].p+=c.papers;});
document.getElementById('incomeTableBody').innerHTML=['HIC','UMIC','LMIC'].filter(k=>g[k]).map(k=>{
  const cs=g[k].cs,n=cs.length;
  const mG=Math.round(cs.reduce((s,c)=>s+(c.gdp_pc||0),0)/n);
  const mH=(cs.reduce((s,c)=>s+(c.hdi||0),0)/n).toFixed(3);
  const hpCs=cs.filter(c=>c.hc_pct);const mHp=hpCs.length?(hpCs.reduce((s,c)=>s+c.hc_pct,0)/hpCs.length).toFixed(1):'—';
  const hcCs=cs.filter(c=>c.hc_cap);const mHc=hcCs.length?Math.round(hcCs.reduce((s,c)=>s+c.hc_cap,0)/hcCs.length):'—';
  const rCs=cs.filter(c=>c.rd);const mR=rCs.length?(rCs.reduce((s,c)=>s+c.rd,0)/rCs.length).toFixed(2):'—';
  const cls=k==='HIC'?'b-hic':k==='UMIC'?'b-umic':'b-lmic';
  return `<tr><td><span class="badge ${cls}">${incomeLabels[k]}</span></td>
    <td class="n">${n}</td><td class="n">${g[k].p}</td><td class="n">${((g[k].p/known)*100).toFixed(1)}%</td>
    <td class="n">$${mG.toLocaleString()}</td><td class="n">${mH}</td>
    <td class="n">${mHp}%</td><td class="n">${typeof mHc==='number'?'$'+mHc.toLocaleString():mHc}</td>
    <td class="n">${mR}%</td></tr>`;
}).join('');}
</script>

</body>
</html>
